<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>{{ app_name }} ‚Äî Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
  </style>
</head>
<body>
  <header>
    <h1>{{ app_name }} ‚Äî Admin</h1>
  </header>
  <main>

    {% if not is_authenticated %}  <!-- –ò–ó–ú–ï–ù–ï–ù–ò–ï –ó–î–ï–°–¨: session.is_admin ‚Üí is_authenticated -->
    <div class="card login">
      <h3>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
      <p class="muted small">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.</p>
      {% if error %}<p class="err badge">{{ error }}</p>{% endif %}
      <form method="post" action="/admin">
        <p><input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" autofocus></p>
        <p><button class="primary">–í–æ–π—Ç–∏</button></p>
      </form>
    </div>
    {% else %}

    <!-- –û—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —à–∞–±–ª–æ–Ω–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <div class="row" style="margin-bottom:16px">
      <div><b>–í—Å–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤:</b> {{ devices|length }}</div>
      <div style="text-align:right">
        <a href="/admin/config" class="config-btn" style="text-decoration:none;padding:8px 12px;border-radius:8px;display:inline-block">üîß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥</a>
        <a href="/admin/logout" class="muted small" style="margin-left:16px">–í—ã–π—Ç–∏</a>
      </div>
    </div>

    <div class="card">
      <table>
        <thead>
          <tr>
            <th>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th>
            <th>–°–æ—Å—Ç–æ—è–Ω–∏–µ</th>
            <th>–ü–ª–∞—Ç–µ–∂–∏</th>
            <th>–ü–æ–ø—ã—Ç–∫–∏</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {% for d in devices %}
          {% set active = d.sub_active or d.dev_mode %}
          <tr>
            <td>
              <div><b>{{ d.device_id }}</b></div>
              <div class="small muted">seen: {{ d.last_seen or "‚Äî" }}</div>
              <div class="small muted">created: {{ d.created_at or "‚Äî" }}</div>
            </td>
            <td>
              {% if d.dev_mode %}
                <span class="badge dev">DEV (–±–µ—Å—Å—Ä–æ—á–Ω–æ)</span>
              {% elif d.sub_active %}
                <span class="badge ok">–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞</span>
                <div class="small muted">–¥–æ: {{ d.sub_expires_at or "‚Äî" }}</div>
              {% else %}
                <span class="badge err">–ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏</span>
              {% endif %}
            </td>
            <td class="tx">
              {% if d.last_tx or d.last_comment %}
                <div>TX: {{ d.last_tx or "‚Äî" }}</div>
                <div>–ö–æ–º–º: {{ d.last_comment or "‚Äî" }}</div>
                {% if d.selected_plan %}
                <div class="small muted">–ü–ª–∞–Ω: {{ d.selected_plan }}</div>
                {% endif %}
                <div class="small muted">–î–Ω–µ–π: {{ d.last_plan_days or "‚Äî" }}</div>
                <div class="small muted">–¶–µ–Ω–∞: {{ d.last_plan_price or "‚Äî" }}</div>
              {% else %}
                <span class="muted small">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
              {% endif %}
            </td>
            <td>
              <b>{{ d.free_left }}</b>
              <div class="small muted">–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ: 3</div>
            </td>
            <td class="actions">
              <!-- –ö–∞—Å—Ç–æ–º–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ -->
              <form method="post" action="/admin/action" class="custom-action">
                <input type="hidden" name="device_id" value="{{ d.device_id }}">
                <input type="hidden" name="action" value="grant_custom">
                <input type="number" name="plan_days" placeholder="–î–Ω–µ–π" min="1" max="365" style="width:80px;padding:4px 8px;font-size:14px">
                <button class="success" type="submit">–í—ã–¥–∞—Ç—å</button>
              </form>

              <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ -->
              <form method="post" action="/admin/action">
                <input type="hidden" name="device_id" value="{{ d.device_id }}">
                <input type="hidden" name="action" value="grant30">
                <button class="success">30 –¥–Ω.</button>
              </form>

              <form method="post" action="/admin/action">
                <input type="hidden" name="device_id" value="{{ d.device_id }}">
                <input type="hidden" name="action" value="grant7">
                <button class="success">7 –¥–Ω.</button>
              </form>

              <form method="post" action="/admin/action">
                <input type="hidden" name="device_id" value="{{ d.device_id }}">
                <input type="hidden" name="action" value="grant3">
                <button class="success">3 –¥–Ω.</button>
              </form>

              <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π -->
              <form method="post" action="/admin/action">
                <input type="hidden" name="device_id" value="{{ d.device_id }}">
                <input type="hidden" name="action" value="remove_sub">
                <button>–£–±—Ä–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
              </form>

              <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DEV —Ä–µ–∂–∏–º–æ–º -->
              <form method="post" action="/admin/action">
                <input type="hidden" name="device_id" value="{{ d.device_id }}">
                <input type="hidden" name="action" value="toggle_dev">
                <button class="vio">{% if d.dev_mode %}–û—Ç–∫–ª. DEV{% else %}–í–∫–ª. DEV{% endif %}</button>
              </form>

              <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ -->
              <form method="post" action="/admin/action">
                <input type="hidden" name="device_id" value="{{ d.device_id }}">
                <input type="hidden" name="action" value="reset_free">
                <button class="primary" title="–í–µ—Ä–Ω—É—Ç—å 3 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∏">‚Üª 3 –ø–æ–ø—ã—Ç–∫–∏</button>
              </form>

              <form method="post" action="/admin/action">
                <input type="hidden" name="device_id" value="{{ d.device_id }}">
                <input type="hidden" name="action" value="zero_free">
                <button class="warn" title="–û–±–Ω—É–ª–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏">0 –ø–æ–ø—ã—Ç–æ–∫</button>
              </form>

              <!-- –û—á–∏—Å—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π -->
              <form method="post" action="/admin/action" onsubmit="return confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π?');">
                <input type="hidden" name="device_id" value="{{ d.device_id }}">
                <input type="hidden" name="action" value="clear_tx">
                <button class="warn" title="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é TX">–û—á–∏—Å—Ç–∏—Ç—å TX</button>
              </form>

              <!-- –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ -->
              <form method="post" action="/admin/action" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ?');">
                <input type="hidden" name="device_id" value="{{ d.device_id }}">
                <input type="hidden" name="action" value="delete">
                <button class="danger">–£–¥–∞–ª–∏—Ç—å</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% endif %}
  </main>
</body>
</html>
