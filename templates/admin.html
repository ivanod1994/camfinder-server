<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>{{ app_name }}</title>
<style>
body { background:#0d1117; color:#fff; font-family:Arial; margin:20px; }
h2 { color:#58a6ff; }
table { width:100%; border-collapse:collapse; margin-top:12px; }
th, td { border:1px solid #333; padding:8px; text-align:left; }
th { background:#161b22; }
tr:nth-child(even){background:#1f242c;}
.btn { background:#238636; border:none; padding:6px 10px; border-radius:4px; color:white; cursor:pointer; }
.btn:hover { background:#2ea043; }
.red {color:#ff5555;}
</style>
</head>
<body>
<h2>CamFinder Admin Panel</h2>

<h3>üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h3>
<table>
<tr><th>ID</th><th>–ê–∫—Ç–∏–≤–Ω–∞</th><th>–ò—Å—Ç–µ–∫–∞–µ—Ç</th><th>Free Left</th><th>Dev</th></tr>
{% for d in devices %}
<tr>
<td>{{ d.device_id }}</td>
<td>{{ '‚úÖ' if d['sub_active'] else '‚ùå' }}</td>
<td>{{ d['sub_expires_at'] or '-' }}</td>
<td>{{ d['free_left'] }}</td>
<td>{{ 'üß©' if d['dev_mode'] else '-' }}</td>
</tr>
{% endfor %}
</table>

<h3>üí≥ –ó–∞—è–≤–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É</h3>
<table>
<tr><th>–í—Ä–µ–º—è</th><th>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th><th class="red">TX</th><th class="red">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr>
{% for p in payments %}
<tr>
<td>{{ p['created_at'] }}</td>
<td>{{ p['device_id'] }}</td>
<td class="red">{{ p['tx'] or '-' }}</td>
<td class="red">{{ p['comment'] or '-' }}</td>
<td>{{ p['status'] }}</td>
<td>
<form method="post" onsubmit="return activate('{{ p['device_id'] }}')">
<button class="btn" type="submit">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
</form>
</td>
</tr>
{% endfor %}
</table>

<script>
async function activate(device_id){
  const resp = await fetch('/api/admin/activate',{
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({device_id})
  });
  if(resp.ok) alert('–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è '+device_id);
  else alert('–û—à–∏–±–∫–∞');
  return false;
}
</script>
</body>
</html>
