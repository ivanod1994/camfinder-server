<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>{{ app_name }} ‚Äî Admin Config</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg:#0b0f17;
      --card:#121a27;
      --muted:#9fb3ce;
      --text:#e8f0ff;
      --green:#18c964;
      --red:#ff4d4f;
      --amber:#f5a524;
      --blue:#2f80ed;
      --vio:#8a63d2;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font:16px/1.5 system-ui,Segoe UI,Roboto,Ubuntu,sans-serif;
      background:linear-gradient(180deg,#0b0f17 0%,#0e1522 100%) fixed;
      color:var(--text);
    }
    header{
      padding:24px 16px; text-align:center;
      border-bottom:1px solid rgba(255,255,255,.06);
      background:rgba(0,0,0,.2); backdrop-filter:blur(6px);
      position:sticky; top:0; z-index:3;
    }
    h1{margin:0;font-size:22px;letter-spacing:.3px}
    main{max-width:1100px;margin:24px auto;padding:0 12px}
    .card{
      background:var(--card); border:1px solid rgba(255,255,255,.06);
      border-radius:14px; padding:24px; margin-bottom:24px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    .muted{color:var(--muted)}
    .form-group{margin-bottom:16px}
    label{display:block;margin-bottom:6px;color:var(--muted);font-weight:500}
    input[type="text"], input[type="number"]{
      width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
      background:#0e1522;color:#eaf2ff;outline:none;
    }
    button{
      background:#1a2333;color:#cfe1ff;border:1px solid rgba(255,255,255,.08);
      padding:10px 16px;border-radius:10px;cursor:pointer;transition:.15s;
      font-weight:500;
    }
    button:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.15)}
    .primary{background:rgba(47,128,237,.1);color:#bcd8ff;border-color:rgba(47,128,237,.35)}
    .success{background:rgba(24,201,100,.1);color:#9ef3c4;border-color:rgba(24,201,100,.35)}
    .danger{background:rgba(255,77,79,.08);color:#ffb4b5;border-color:rgba(255,77,79,.25)}
    .row{display:flex;gap:12px;margin-top:12px}
    .small{font-size:12px}
    .error{color:var(--red);margin-bottom:12px;padding:8px;background:rgba(255,77,79,.08);border-radius:8px}
    .actions{text-align:right;margin-top:24px}
    .back-link{
      display:inline-block;margin-bottom:16px;color:var(--blue);
      text-decoration:none;border-bottom:1px dashed var(--blue);
    }
    .back-link:hover{opacity:0.8}
    .config-section{margin-bottom:32px}
    .config-title{font-size:18px;font-weight:600;color:#bcd1ef;margin-bottom:16px;display:flex;justify-content:space-between;align-items:center}
    .add-btn{background:rgba(24,201,100,.1);color:#9ef3c4;border:1px dashed rgba(24,201,100,.4);padding:6px 12px;font-size:14px}
    .remove-btn{background:rgba(255,77,79,.1);color:#ffb4b5;border:1px dashed rgba(255,77,79,.3);padding:6px 10px;font-size:12px;cursor:pointer;border-radius:6px}
    .wallet-row, .price-row{display:flex;gap:8px;margin-bottom:8px;align-items:center}
    .wallet-name{flex:1}
    .wallet-addr{flex:3}
    .price-key{flex:1}
    .price-usd{flex:0.6}
    .price-days{flex:0.6}
    .price-desc{flex:1.5}
    .field-header{display:flex;gap:8px;margin-bottom:8px;padding:0 4px}
    .field-header>div{font-size:12px;color:var(--muted);font-weight:500}
    .info-text{color:var(--muted);font-size:13px;margin-top:4px}
  </style>
</head>
<body>
  <header>
    <h1>{{ app_name }} ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h1>
  </header>
  <main>
    <a href="/admin/dashboard" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º</a>
    
    {% if error %}
    <div class="error">{{ error }}</div>
    {% endif %}
    
    <form method="post" action="/admin/config">
      <!-- –¢–∞—Ä–∏—Ñ—ã -->
      <div class="config-section">
        <div class="config-title">
          <span>–¢–∞—Ä–∏—Ñ—ã –ø–æ–¥–ø–∏—Å–∫–∏</span>
          <button type="button" class="add-btn" onclick="addPriceRow()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–∞—Ä–∏—Ñ</button>
        </div>
        
        <div class="field-header">
          <div class="price-key">–ö–ª—é—á —Ç–∞—Ä–∏—Ñ–∞</div>
          <div class="price-usd">–¶–µ–Ω–∞ (USD)</div>
          <div class="price-days">–î–Ω–∏</div>
          <div class="price-desc">–û–ø–∏—Å–∞–Ω–∏–µ</div>
          <div style="width:40px"></div>
        </div>
        
        <div id="prices-container">
          {% for key, info in config.prices.items() %}
          <div class="price-row">
            <input type="text" name="price_key_{{ loop.index0 }}" value="{{ key }}" placeholder="3 –¥–Ω—è" class="price-key" required>
            <input type="number" name="price_value_{{ loop.index0 }}" value="{{ info.usd }}" step="0.01" placeholder="3.00" class="price-usd" required>
            <input type="number" name="price_days_{{ loop.index0 }}" value="{{ info.days }}" placeholder="3" class="price-days" required>
            <input type="text" name="price_desc_{{ loop.index0 }}" value="{{ info.desc }}" placeholder="3 –¥–Ω—è –¥–æ—Å—Ç—É–ø–∞" class="price-desc" required>
            <span class="remove-btn" onclick="this.parentElement.remove()">√ó</span>
          </div>
          {% endfor %}
        </div>
        <div class="info-text">–ö–ª—é—á —Ç–∞—Ä–∏—Ñ–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: "3 –¥–Ω—è", "7 –¥–Ω–µ–π", "30 –¥–Ω–µ–π")</div>
      </div>
      
      <!-- –ö–æ—à–µ–ª—å–∫–∏ -->
      <div class="config-section">
        <div class="config-title">
          <span>–ö—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª—å–∫–∏</span>
          <button type="button" class="add-btn" onclick="addWalletRow()">+ –î–æ–±–∞–≤–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
        </div>
        
        <div class="field-header">
          <div class="wallet-name">–ù–∞–∑–≤–∞–Ω–∏–µ</div>
          <div class="wallet-addr">–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞</div>
          <div style="width:40px"></div>
        </div>
        
        <div id="wallets-container">
          {% for name, addr in config.wallets.items() %}
          <div class="wallet-row">
            <input type="text" name="wallet_name_{{ loop.index0 }}" value="{{ name }}" placeholder="BTC, ETH, USDT" class="wallet-name" required>
            <input type="text" name="wallet_addr_{{ loop.index0 }}" value="{{ addr }}" placeholder="–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞" class="wallet-addr" required>
            <span class="remove-btn" onclick="this.parentElement.remove()">√ó</span>
          </div>
          {% endfor %}
        </div>
        <div class="info-text">–ù–∞–∑–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: BTC, ETH, USDT)</div>
      </div>
      
      <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div class="config-section">
        <div class="config-title">
          <span>–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>
        </div>
        
        <div class="form-group">
          <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</label>
          <input type="number" name="initial_free" value="3" min="0" max="100" readonly style="background:rgba(255,255,255,.05);color:var(--muted)">
          <div class="info-text">–ò–∑–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∫–æ–¥–µ —Å–µ—Ä–≤–µ—Ä–∞ (INITIAL_FREE = 3)</div>
        </div>
        
        <div class="form-group">
          <label>–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
          <input type="text" name="admin_password" value="********" readonly style="background:rgba(255,255,255,.05);color:var(--muted)">
          <div class="info-text">–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è ADMIN_PASSWORD</div>
        </div>
      </div>
      
      <div class="actions">
        <button type="button" class="danger" onclick="if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) resetToDefault()">–°–±—Ä–æ—Å–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
        <button type="submit" class="primary" style="padding:12px 24px;font-size:16px">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
      </div>
    </form>
  </main>

  <script>
    let priceIndex = {{ config.prices|length }};
    let walletIndex = {{ config.wallets|length }};
    
    function addPriceRow() {
      const container = document.getElementById('prices-container');
      const row = document.createElement('div');
      row.className = 'price-row';
      row.innerHTML = `
        <input type="text" name="price_key_${priceIndex}" placeholder="3 –¥–Ω—è" class="price-key" required>
        <input type="number" name="price_value_${priceIndex}" step="0.01" placeholder="3.00" class="price-usd" required>
        <input type="number" name="price_days_${priceIndex}" placeholder="3" class="price-days" required>
        <input type="text" name="price_desc_${priceIndex}" placeholder="3 –¥–Ω—è –¥–æ—Å—Ç—É–ø–∞" class="price-desc" required>
        <span class="remove-btn" onclick="this.parentElement.remove()">√ó</span>
      `;
      container.appendChild(row);
      priceIndex++;
    }
    
    function addWalletRow() {
      const container = document.getElementById('wallets-container');
      const row = document.createElement('div');
      row.className = 'wallet-row';
      row.innerHTML = `
        <input type="text" name="wallet_name_${walletIndex}" placeholder="BTC" class="wallet-name" required>
        <input type="text" name="wallet_addr_${walletIndex}" placeholder="bc1q..." class="wallet-addr" required>
        <span class="remove-btn" onclick="this.parentElement.remove()">√ó</span>
      `;
      container.appendChild(row);
      walletIndex++;
    }
    
    function resetToDefault() {
      const defaultPrices = {
        "3 –¥–Ω—è": {usd: 3.0, days: 3, desc: "3 –¥–Ω—è –¥–æ—Å—Ç—É–ø–∞"},
        "7 –¥–Ω–µ–π": {usd: 6.0, days: 7, desc: "7 –¥–Ω–µ–π –¥–æ—Å—Ç—É–ø–∞"},
        "30 –¥–Ω–µ–π": {usd: 10.0, days: 30, desc: "30 –¥–Ω–µ–π –¥–æ—Å—Ç—É–ø–∞"}
      };
      
      const defaultWallets = {
        "BTC": "bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh",
        "ETH": "0x71C7656EC7ab88b098defB751B7401B5f6d8976F",
        "USDT": "THXrLBqa1QE1ZNFh2p48bWfQKYEDnTSYwT"
      };
      
      document.getElementById('prices-container').innerHTML = '';
      document.getElementById('wallets-container').innerHTML = '';
      
      priceIndex = 0;
      for (const [key, info] of Object.entries(defaultPrices)) {
        addPriceRow();
        const lastRow = document.querySelector('#prices-container .price-row:last-child');
        const inputs = lastRow.querySelectorAll('input');
        inputs[0].value = key;
        inputs[1].value = info.usd;
        inputs[2].value = info.days;
        inputs[3].value = info.desc;
      }
      
      walletIndex = 0;
      for (const [name, addr] of Object.entries(defaultWallets)) {
        addWalletRow();
        const lastRow = document.querySelector('#wallets-container .wallet-row:last-child');
        const inputs = lastRow.querySelectorAll('input');
        inputs[0].value = name;
        inputs[1].value = addr;
      }
      
      alert('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å!');
    }
  </script>
</body>
</html>
